<?xml version="1.0" encoding="UTF-8"?>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9" xmlns:xhtml="http://www.w3.org/1999/xhtml">
{%- for file in pages %}
    {%- if file.page.is_link %}
        {%- continue %}
    {%- endif %}

    {%- if file.page.canonical_url %}
        {%- set main_loc = file.page.canonical_url | e %}
    {%- elif file.page.abs_url %}
        {%- set main_loc = file.page.abs_url | e %}
    {%- else %}
        {%- set main_loc = config.site_url ~ file.url %}
    {%- endif %}

    {#-
        Warning! Don't align the XML tags based on the Jinja2 statements.
        It will cause whitespace misalignment in the output.
    #}
    <url>
        <loc>{{ main_loc }}</loc>
        {%- if file.page.update_date %}
        <lastmod>{{ file.page.update_date }}</lastmod>
        {%- endif %}
        <changefreq>daily</changefreq>
        {%- for locale, link_file in file.alternates.items() %}
            {%- if not link_file %}
                {%- continue %}
            {%- endif %}

            {%- if link_file.page.canonical_url %}
                {%- set link_href = link_file.page.canonical_url | e %}
            {%- elif link_file.page.abs_url %}
                {%- set link_href = link_file.page.abs_url | e %}
            {%- else %}
                {%- set link_href = config.site_url ~ link_file.url %}
            {%- endif %}
        <xhtml:link rel="alternate" hreflang="{{ locale }}" href="{{ link_href }}"/>
        {%- endfor %}
        <xhtml:link rel="alternate" hreflang="x-default" href="{{ main_loc }}"/>
    </url>
    {%- for loc_file in file.alternates.values() %}
        {%- if not loc_file %}
            {%- continue %}
        {%- endif %}

        {%- if loc_file.page.canonical_url %}
            {%- set lang_loc = loc_file.page.canonical_url | e %}
        {%- elif loc_file.page.abs_url %}
            {%- set lang_loc = loc_file.page.abs_url | e %}
        {%- else %}
            {%- set lang_loc = config.site_url ~ loc_file.url %}
        {%- endif %}

    {#-
        Warning! Don't align the XML tags based on the Jinja2 statements.
        It will cause whitespace misalignment in the output.
    #}
    <url>
        <loc>{{ lang_loc }}</loc>
        {%- if loc_file.page.update_date %}
        <lastmod>{{ loc_file.page.update_date }}</lastmod>
        {%- endif %}
        <changefreq>daily</changefreq>
        {%- for locale, link_file in file.alternates.items() %}
            {%- if not link_file %}
                {%- continue %}
            {%- endif %}

            {%- if link_file.page.canonical_url %}
                {%- set link_href = link_file.page.canonical_url | e %}
            {%- elif link_file.page.abs_url %}
                {%- set link_href = link_file.page.abs_url | e %}
            {%- else %}
                {%- set link_href = config.site_url ~ link_file.url %}
            {%- endif %}
        <xhtml:link rel="alternate" hreflang="{{ locale }}" href="{{ link_href }}"/>
        {%- endfor %}
        <xhtml:link rel="alternate" hreflang="x-default" href="{{ main_loc }}"/>
    </url>
    {%- endfor %}
{%- endfor %}
</urlset>
